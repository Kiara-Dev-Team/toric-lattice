# ToricCore: Computational Algebraic Geometry for Fans

[![Python 3.8+](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

**ToricCore** is a Python-based R&D library developed to verify deep conjectures in toric geometry, specifically focusing on the **Intersection Hodge Conjecture (IHC)** and **Canonical Lattice Filtrations**.

## üî¨ Theoretical Foundations

This library implements the frameworks established in:

1. **"The Intersection Cohomology of a Fan and the Hodge Conjecture for Toric Varieties"** ([arXiv:2512.06755](https://arxiv.org/abs/2512.06755))
2. **"Canonical Lattices and Integer Relations Associated to Rational Fans"** ([arXiv:2601.05678](https://arxiv.org/abs/2601.05678))

## üì¶ Installation

### From PyPI (coming soon)
```bash
pip install toriccore
```

### From Source
```bash
git clone https://github.com/Kiara-Dev-Team/toric-lattice.git
cd toric-lattice
pip install -e .
```

### With Visualization Support
```bash
pip install -e ".[visualization]"
```

### Full Installation (all extras)
```bash
pip install -e ".[all]"
```

## üõ† Core Modules

The package is organized into two primary research tracks:

### 1. Intersection Hodge Verification (`ih_hodge_verifier.py`)

Automates the algorithmic framework to test the IHC on projective toric varieties:

- **Stalk Recursion**: Computes local intersection cohomology of links using generalized g-polynomials
- **Sheaf Hypercohomology**: Assembles the minimal extension sheaf IC_Œ£ to find the global dimension d_k = dim(IH^{2k}_comb)
- **Combinatorial Cycle Classes**: Uses the Gysin Map to compute classes [V(œÑ)]_comb = (i_œÑ)_*([Star(œÑ)])
- **Rank Verification**: Checks if cycle classes span the rational Hodge classes

### 2. Canonical Lattice Theory (`lattice_filtration.py`)

Implements coordinate-free integer linear algebra for rational fans:

- **Relation Lattice (L_rel)**: Computes the kernel of the ray matrix V
- **Codimension Filtration (F_k)**: Generates sublattices supported on stars of cones with codim(œÑ) ‚â§ k
- **Local Generation**: Verifies that global relations are generated by local relations on proper stars

### 3. R&D Tools

- **`refinement_analyzer.py`**: Tests Conjecture 5.1 regarding filtration monotonicity under fan subdivision
- **`gysin_map.py`**: Implements the combinatorial Gysin pushforward map
- **`sheaf_complex.py`**: Computes global intersection cohomology via BBFK theory
- **`visualizer.py`**: Provides 3D renders of fans, highlighting cycle class support on sub-fans

## üöÄ Quick Start

### Example: Verifying P¬≤ √ó P¬π

```python
from toriccore import FanFactory, RefinementAnalyzer, HodgeVerifier

# 1. Create the product fan for P¬≤ √ó P¬π
fan = FanFactory.create_p2_x_p1()

# 2. Define the global relation r1 = (1, 1, 1, 0, 0)
r1 = [1, 1, 1, 0, 0]  # v1 + v2 + v3 = 0

# 3. Analyze filtration depth
analyzer = RefinementAnalyzer(fan)
depth = analyzer.calculate_depth(r1)
print(f"Filtration Depth of r1: {depth}")
# Output: 2 (Matches r1 ‚àà F_2 \ F_1)

# 4. Verify Hodge Conjecture
verifier = HodgeVerifier(fan)
report = verifier.run_verification()
print(report)
```

### Example: Creating Custom Fans

```python
import numpy as np
from toriccore import Fan, ToricLatticeModule

# Define rays as column vectors
rays = np.array([
    [1, 0, -1, 0],
    [0, 1, 0, -1]
])

# Define maximal cones by ray indices
maximal_cones = [(0, 1), (1, 2), (2, 3), (3, 0)]

# Create fan
fan = Fan(rays, maximal_cones)

# Analyze lattice structure
module = ToricLatticeModule(fan.ray_matrix, fan)
kernel = module.get_global_relation_lattice()
print(f"Relation lattice rank: {np.linalg.matrix_rank(kernel)}")
```

### Example: Visualization

```python
from toriccore import FanFactory, ToricVisualizer

# Create P¬≤ fan
fan = FanFactory.create_p2()

# Visualize
viz = ToricVisualizer(fan)
viz.plot_fan_2d()

# Highlight cycle class support
viz.highlight_cycle_support((0,))  # Star of first ray
```

## üìà Research Roadmap

- **Dimensions n ‚â• 4**: Verifying the IHC for non-simplicial fans in high dimensions
- **Non-Rational Fans**: Testing if "combinatorial Hodge classes" retain meaning without a variety
- **Integer Coefficients**: Moving from Q to Z to track torsion in intersection cohomology
- **Computational Optimization**: Improving algorithms for large-scale fan computations

## üß™ Running Tests

```bash
# Run all tests
python -m pytest tests/

# Run specific test file
python tests/test_refinement_p2p1.py

# Run with verbose output
python -m pytest tests/ -v
```

## üìö API Reference

### Core Classes

| Class | Description |
|-------|-------------|
| `Fan` | Represents a rational polyhedral fan |
| `FanFactory` | Factory methods for common toric varieties |
| `ToricLatticeModule` | Computes relation lattices and filtrations |
| `RefinementAnalyzer` | Analyzes filtration behavior under refinement |
| `HodgeVerifier` | Verifies the Intersection Hodge Conjecture |
| `GysinMap` | Computes combinatorial cycle classes |
| `SheafComplex` | BBFK sheaf hypercohomology calculations |
| `ToricVisualizer` | 2D/3D visualization of fans |

### Key Methods

```python
# Fan construction
fan = FanFactory.create_p2_x_p1()
fan = FanFactory.create_pn(4)  # P^4

# Lattice analysis
module = ToricLatticeModule(ray_matrix, fan)
kernel = module.get_global_relation_lattice()
F_k = module.compute_filtration_step(k)
depth = module.compute_filtration_depth(relation)

# Hodge verification
verifier = HodgeVerifier(fan)
report = verifier.run_verification()

# Refinement analysis
analyzer = RefinementAnalyzer(base_fan, refined_fan)
result = analyzer.verify_monotonicity(relation)
```

## üì¨ Contact

**Rizwan Jahangir**
- Email: rizwan@kiara.team
- Alternate: rizwan.jahangir@nbs.nust.edu.pk
- Affiliations: Kiara Inc. Tokyo & NUST Business School

## üìÑ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## üôè Acknowledgments

- The BBFK (Barthel, Brasselet, Fieseler, Kaup) framework for combinatorial intersection cohomology
- Karu's work on Hard Lefschetz theorem for simplicial fans
- The algebraic geometry community for ongoing discussions and feedback

## üìñ Citation

If you use ToricCore in your research, please cite:

```bibtex
@software{toriccore2025,
  author = {Jahangir, Rizwan},
  title = {ToricCore: Computational Algebraic Geometry for Fans},
  year = {2025},
  url = {https://github.com/Kiara-Dev-Team/toric-lattice}
}
```

And the underlying papers:

```bibtex
@article{arxiv2512.06755,
  title = {The Intersection Cohomology of a Fan and the Hodge Conjecture for Toric Varieties},
  author = {Jahangir, Rizwan},
  journal = {arXiv preprint arXiv:2512.06755},
  year = {2024}
}

@article{arxiv2601.05678,
  title = {Canonical Lattices and Integer Relations Associated to Rational Fans},
  author = {Jahangir, Rizwan},
  journal = {arXiv preprint arXiv:2601.05678},
  year = {2025}
}
```